% documentdefinitions.tex
% Macro's not beloning to any specific type of document
% The LuaTeX Version
%
% Author:  Tim Steenvoorden
% Changed: 14 Dec 2011
%
\startenvironment documentdefinitions

\writestatus{environment}{Loading shared definitions}

% -----------------------------------------------------------------------------
% Mark II versus Mark IV
% -----------------------------------------------------------------------------

\startmode[*mkii]
  \def\word{\lowercase}%FIXME
  \def\setupmargindata[inmargin]{\setupinmargin}
  \def\setupnotation[footnote]{\setupfootnotedefinition}
\stopmode

\startmode[*mkiv]%FIXME
  \def\completepublications[#1]{}
\stopmode

% -----------------------------------------------------------------------------
% Language
% -----------------------------------------------------------------------------

\setuplanguage[en]
  [spacing=packed]
\setuplanguage[nl]
  [leftquote=\upperleftsinglesixquote,
   rightquote=\upperrightsingleninequote,
   leftquotation=\upperleftdoublesixquote,
   rightquotation=\upperrightdoubleninequote]

\setupdelimitedtext[quote][2]
  [left={\symbol[leftquotation]},
   right={\symbol[rightquotation]}]
\setupdelimitedtext[quotation][2]
  [left={\symbol[leftquote]},
   right={\symbol[rightquote]}]

% -----------------------------------------------------------------------------
% Typeface TODO
% -----------------------------------------------------------------------------

\definefontfeature[tabular][default]
  [tnum=yes]
\definefont[tb][Serif*tabular]

% -----------------------------------------------------------------------------
% Directories
% -----------------------------------------------------------------------------

\setupexternalfigures
  [directory={figuren,afbeeldingen,figures,images,
              ../figuren,../afbeeldingen,../figures,../images}]

% -----------------------------------------------------------------------------
% Emphasize & Alert
% -----------------------------------------------------------------------------

\define[1]\emph
  {{\em #1}}
\definestartstop[emphasize]
  [style=\em]

\define[1]\alert
  {{\ss\bf #1}}

\define[1]\online
  {\useurl[online][#1]
   \url[online]}

\defineparagraphs[sidebysidetext]
  [n=2]

% -----------------------------------------------------------------------------
% Todo's
% -----------------------------------------------------------------------------

%\definelist[todo]
  %[alternative=a,
   %partnumber=no,
   %pagestyle=\quad\it]
%\definecombinedlist[todos]
  %[chapter,todo]
%\setupcombinedlist[todos]
  %[level=current,% Waarom weet ik ook niet, maar het werkt.
   %interaction=pagenumber]

\defineregister[todos]
\setupregister[todos]
  [n=1,
   indicator=no,
   before={\blank[none]}]

\starttexdefinition todo
  \dodoublegroupempty\dotodo
\stoptexdefinition

\starttexdefinition dotodo #1#2
  \doifemptyelse{#2}
    {\inmargin{Todo}
     \underbar{#1}
     \todos{Todo+#1}}
    {\inmargin{#1}
     \underbar{#2}
     \todos{#1+#2}}
\stoptexdefinition

% -----------------------------------------------------------------------------
% Referencing
% -----------------------------------------------------------------------------

\starttexdefinition see [#1:#2]
  \doifdefinedelse{in#1}
    {\getvalue{in#1}[#1:#2]}
    {\writestatus{warning}{referenceformat in#1 not defined}
     \in[#1:#2]}
\stoptexdefinition % #3 is optional and gobbled bij \in

\definereferenceformat[insec]
  [left=ยง]
\definereferenceformat[inchp]
  [text=\word{\labeltext{chapter}}]
\definereferenceformat[inapp]
  [text=\word{\labeltext{appendix}}]
\definereferenceformat[infig]
  [text=\word{\labeltext{figure}}]
\definereferenceformat[intab]
  [text=\word{\labeltext{table}}]
\definereferenceformat[infor]
  [left=(,
   right=)]

% -----------------------------------------------------------------------------
% Math Commands
% -----------------------------------------------------------------------------

\let\phi=\varphi
\let\epsilon=\varepsilon

\definemathcommand[arcsinh][nolop]
  {\mfunction{arcsinh}}
\definemathcommand[arccosh][nolop]
  {\mfunction{arccosh}}
\definemathcommand[arctanh][nolop]
  {\mfunction{arctanh}}
\definemathcommand[e][nolop]
  {\mfunction{e}}

\define\total
  {{\rm d}}
\define[2]\tdiff
  {\frac{\total #1}{\total #2}}
\define[1]\ddiff
  {\tdiff{}{#1}}
\define[2]\pdiff
  {\frac{\partial #1}{\partial #2}}

\redefine\d
  {{\rm d}}
\define\D
  {{\cal D}}
\define[1]\dd
  {{\textstyle\tdiff{}{#1}}}
\define\p
  {\partial}
\define[1]\pp
  {{\textstyle\pdiff{}{#1}}}

%FIXME: cannot be \redefine'ed
\define[1]\vec
  {{\bf #1}}
\define[1]\mat
  {\text{\ss\bf #1}}
%\define[1]\op
  %{\hat{#1}}

\define\cross
  {\times}
\define\Grad
  {\vec{\nabla}}
\define[1]\Div
  {\vec{\nabla}\cdot\vec{#1}}
\define[1]\Curl
  {\vec{\nabla}\cross\vec{#1}}
\define\Lapl
  {\vec{\nabla}^2}

\redefine\implies
  {\Rightarrow}
\redefine\iff
  {\Leftrightarrow}
%\define\to
%\define\mapsto
%\define\leadsto

\define[1]\E
  {\math{\cdot 10^{#1}}}
\define[1]\unitfrac
  {{\textstyle\frac{1}{#1}}}
\define\half
  {\unitfrac{2}}
\define\third
  {\unitfrac{3}}
\define\rhbar
  {\unitfrac{\hbar}}
\define\rhslash
  {\unitfrac{\hslash}}

% -----------------------------------------------------------------------------
% Math Alignment
% -----------------------------------------------------------------------------

\definemathalignment[gather]
  [n=1,
   align=left,
   distance=1em plus 1 fill]

\starttexdefinition startsplit
  \dosingleempty\dostartsplit
\stoptexdefinition

\starttexdefinition dostartsplit [#1]
  \define\SC{\NC}
  \define\SR{\NR\NC\NC}
  \startalign[#1]
    \NC
\stoptexdefinition

\starttexdefinition stopsplit
    \NR[+]
  \stopalign
\stoptexdefinition

\starttexdefinition startspread
  \dosingleempty\dostartspread
\stoptexdefinition

\starttexdefinition dostartspread [#1]
  \define\SC{\NC}
  \define\SR{\NR\NC}
  \startgather[m=2,#1]
    \NC
\stoptexdefinition

\starttexdefinition stopspread
    \NR[+]
  \stopgather
\stoptexdefinition

\starttexdefinition startsteps
  \dosingleempty\dostartsteps
\stoptexdefinition

\starttexdefinition dostartsteps [#1]
  \define\SR{\NR\NC\NC\implies\NC}
  \startalign[m=2,#1]
    \NC\NC \NC
\stoptexdefinition

\starttexdefinition stopsteps
    \NR[+]
  \stopalign
\stoptexdefinition

% -----------------------------------------------------------------------------
% TikZ pictures
% -----------------------------------------------------------------------------

\starttexdefinition setuptikz
  \dosingleargument\dosetuptikz
\stoptexdefinition

\starttexdefinition dosetuptikz [#1]
  \getparameters[tikzparam][#1]
  \doifinset{\tikzparamboxed}{yes,on}
    {\dotikzboxed}
\stoptexdefinition

\starttexdefinition dotikzboxed
  \let\normalstarttikzpicture\starttikzpicture
  \let\normalstoptikzpicture\stoptikzpicture

  \redefine\starttikzpicture
    {\hbox\bgroup\normalstarttikzpicture} 
  \redefine\stoptikzpicture
    {\normalstoptikzpicture\egroup}
\stoptexdefinition

\starttexdefinition setuptikzstyle
  \dodoubleargument\dosetuptikzstyle
\stoptexdefinition

\starttexdefinition dosetuptikzstyle [#1][#2]
  \tikzset{#1/.style={#2}}
\stoptexdefinition

% -----------------------------------------------------------------------------
% Tabbed data
% -----------------------------------------------------------------------------

\usemodule[database]

\defineseparatedlist[tabbeddata]
  [separator=tab,
   first=\NC,
   right=\NC,
   last=\NR]

\starttexdefinition externaltabbeddata [#1]
  \processseparatedfile[tabbeddata][#1]
\stoptexdefinition

% -----------------------------------------------------------------------------
% Bibliography
% -----------------------------------------------------------------------------

\define\inlinecite
  {\cite[authoryear]}

\stopenvironment

% vim: ts=2 sw=2 et
